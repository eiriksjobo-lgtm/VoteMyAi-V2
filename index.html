<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VoteMyAI ‚Äì AI Music Voting Platform</title>
  
  <!-- SEO Meta Tags -->
  <meta name="description" content="Submit your AI-generated music tracks and let the community vote. Discover the best AI music from Suno, Udio, ElevenLabs and more.">
  <meta name="keywords" content="AI music, vote, AI generated music, Suno, Udio, ElevenLabs, music voting, leaderboard">
  <meta name="author" content="VoteMyAI">
  
  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://www.votemyai.com/">
  <meta property="og:title" content="VoteMyAI ‚Äì Vote the Future of AI Music">
  <meta property="og:description" content="Submit your AI-generated tracks. The community votes. The best rise to the top.">
  <meta property="og:image" content="https://www.votemyai.com/og-image.png">
  <meta property="og:site_name" content="VoteMyAI">
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="VoteMyAI ‚Äì Vote the Future of AI Music">
  <meta name="twitter:description" content="Submit your AI-generated tracks. The community votes. The best rise to the top.">
  <meta name="twitter:image" content="https://www.votemyai.com/og-image.png">
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%230a0a0f'/><text y='72' x='12' font-size='60' font-family='sans-serif' font-weight='bold' fill='%23e8ff47'>V</text></svg>">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;500;700&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --bg: #0a0a0f;
      --surface: #111118;
      --border: #1e1e2e;
      --accent: #e8ff47;
      --text: #f0f0f0;
      --muted: #666680;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: var(--bg); color: var(--text); font-family: 'DM Sans', sans-serif; line-height: 1.6; }
    
    nav { position: sticky; top: 0; background: rgba(10,10,15,0.95); backdrop-filter: blur(16px); border-bottom: 1px solid var(--border); padding: 0 40px; height: 64px; display: flex; align-items: center; justify-content: space-between; z-index: 100; }
    .logo { font-family: 'Bebas Neue', sans-serif; font-size: 1.6rem; letter-spacing: 2px; color: var(--accent); text-decoration: none; }
    .nav-links { display: flex; gap: 32px; align-items: center; }
    .nav-links a { color: var(--muted); text-decoration: none; font-size: 0.8rem; font-weight: 500; letter-spacing: 1px; text-transform: uppercase; transition: color 0.2s; }
    .nav-links a:hover { color: var(--text); }
    .btn-submit { background: var(--accent); color: #0a0a0f; padding: 10px 20px; border-radius: 6px; border: none; font-weight: 700; cursor: pointer; font-size: 0.8rem; letter-spacing: 1px; text-transform: uppercase; }
    .btn-logout { background: rgba(248,113,113,0.1); border: 1px solid rgba(248,113,113,0.3); color: #f87171; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 0.8rem; font-weight: 600; letter-spacing: 1px; text-transform: uppercase; display: none; }
    
    .hero { text-align: center; padding: 120px 40px 80px; max-width: 900px; margin: 0 auto; }
    .hero h1 { font-family: 'Bebas Neue', sans-serif; font-size: clamp(3rem, 8vw, 5rem); letter-spacing: 2px; line-height: 1.1; margin-bottom: 20px; }
    .hero .accent { color: var(--accent); }
    .hero p { color: var(--muted); font-size: 1.1rem; margin-bottom: 40px; }
    
    .tracks-section { max-width: 1200px; margin: 0 auto; padding: 60px 40px; }
    .section-title { font-family: 'Bebas Neue', sans-serif; font-size: 2rem; letter-spacing: 1px; margin-bottom: 32px; text-transform: uppercase; }
    
    .genre-filters { display: flex; gap: 12px; margin-bottom: 32px; flex-wrap: wrap; }
    .genre-btn { background: rgba(232,255,71,0.1); border: 1px solid rgba(232,255,71,0.3); color: var(--accent); padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.85rem; transition: all 0.2s; }
    .genre-btn:hover { background: rgba(232,255,71,0.2); }
    .genre-btn.active { background: var(--accent); color: #0a0a0f; }
    
    .tracks-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 24px; }
    
    /* Skeleton Loaders */
    @keyframes shimmer {
      0% { background-position: -400px 0; }
      100% { background-position: 400px 0; }
    }
    .skeleton {
      background: linear-gradient(90deg, var(--surface) 25%, rgba(255,255,255,0.04) 50%, var(--surface) 75%);
      background-size: 800px 100%;
      animation: shimmer 1.5s infinite ease-in-out;
      border-radius: 8px;
    }
    .skeleton-card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; }
    .skeleton-video { padding-bottom: 56.25%; }
    .skeleton-info { padding: 20px; }
    .skeleton-title { height: 20px; width: 70%; margin-bottom: 12px; }
    .skeleton-meta { height: 14px; width: 40%; margin-bottom: 20px; }
    .skeleton-btn { height: 36px; width: 100%; margin-bottom: 12px; }
    .skeleton-lb-row { height: 56px; border-bottom: 1px solid var(--border); }
    
    /* ‚îÄ‚îÄ Track Cards ‚îÄ‚îÄ */
    .track-card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; transition: transform 0.2s; }
    .track-card:hover { transform: translateY(-4px); }
    
    /* YouTube embed */
    .track-embed { position: relative; overflow: hidden; }
    .track-embed.youtube { padding-bottom: 56.25%; height: 0; }
    .track-embed.youtube iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }
    
    /* SoundCloud embed */
    .track-embed.soundcloud { height: 166px; }
    .track-embed.soundcloud iframe { width: 100%; height: 100%; border: none; }
    
    /* Audio Visualizer for Spotify/SoundCloud cards */
    .visualizer-bg {
      position: relative;
      height: 180px;
      overflow: hidden;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      gap: 3px;
      padding: 0 20px 0;
    }
    .visualizer-bg.soundcloud-bg {
      background: linear-gradient(135deg, #0d1117 0%, #2a1a0d 50%, #0d1117 100%);
    }
    .viz-bar {
      width: 4px;
      border-radius: 2px 2px 0 0;
      animation: vizPulse var(--duration) ease-in-out infinite alternate;
      animation-delay: var(--delay);
      opacity: 0.7;
    }
    .soundcloud-bg .viz-bar { background: #ff8800; }
    
    @keyframes vizPulse {
      0% { height: var(--min-h); opacity: 0.4; }
      100% { height: var(--max-h); opacity: 0.9; }
    }
    
    .visualizer-embed {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 2;
    }
    .visualizer-embed.soundcloud-embed { height: 80px; }
    .visualizer-embed.soundcloud-embed iframe { width: 100%; height: 80px; border: none; }
    
    /* Platform badge on card */
    .platform-label {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 0.7rem;
      font-weight: 600;
      padding: 3px 8px;
      border-radius: 4px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .platform-label.yt { background: rgba(255,0,0,0.12); color: #ff4444; }
    .platform-label.sc { background: rgba(255,136,0,0.12); color: #ff8800; }
    
    .track-info { padding: 20px; }
    .track-title { font-size: 1.1rem; font-weight: 700; margin-bottom: 8px; }
    .track-meta { color: var(--muted); font-size: 0.85rem; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
    .vote-btn { background: rgba(232,255,71,0.1); border: 1px solid rgba(232,255,71,0.3); color: var(--accent); padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.85rem; width: 100%; }
    .vote-btn:hover { background: rgba(232,255,71,0.2); }
    .vote-btn.voted { background: var(--accent); color: #0a0a0f; cursor: default; opacity: 0.8; }
    .vote-btn:disabled { cursor: not-allowed; }
    .votes-count { text-align: center; margin-top: 8px; color: var(--accent); font-weight: 700; font-size: 1.2rem; }
    
    .comments-section { margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border); }
    .comments-toggle { background: none; border: none; color: var(--muted); cursor: pointer; font-size: 0.85rem; padding: 4px 0; }
    .comments-toggle:hover { color: var(--text); }
    .comments-list { margin-top: 12px; display: none; }
    .comments-list.show { display: block; }
    .comment { padding: 8px 0; border-bottom: 1px solid rgba(30,30,46,0.5); }
    .comment:last-child { border-bottom: none; }
    .comment-author { font-weight: 500; font-size: 0.75rem; margin-top: 4px; color: var(--muted); font-style: italic; }
    .comment-text { font-size: 0.85rem; color: var(--text); }
    .comment-input { width: 100%; background: rgba(30,30,46,0.5); border: 1px solid var(--border); color: var(--text); padding: 8px; border-radius: 6px; font-family: 'DM Sans', sans-serif; font-size: 0.85rem; margin-top: 8px; }
    .comment-btn { background: var(--accent); color: #0a0a0f; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 0.8rem; font-weight: 600; margin-top: 8px; }
    
    /* Leaderboard */
    .leaderboard-section { max-width: 800px; margin: 0 auto; padding: 60px 40px; }
    .leaderboard { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; }
    .lb-row { display: flex; align-items: center; gap: 20px; padding: 16px 20px; border-bottom: 1px solid var(--border); transition: background 0.2s; }
    .lb-row:last-child { border-bottom: none; }
    .lb-row:hover { background: rgba(232,255,71,0.05); }
    .lb-rank { font-family: 'Bebas Neue', sans-serif; font-size: 1.5rem; color: var(--accent); width: 40px; text-align: center; }
    .lb-rank.top3 { color: var(--accent); }
    .lb-info { flex: 1; }
    .lb-title { font-weight: 700; font-size: 1rem; margin-bottom: 4px; }
    .lb-meta { color: var(--muted); font-size: 0.85rem; display: flex; align-items: center; gap: 6px; }
    .lb-votes { font-weight: 700; color: var(--accent); font-size: 1.1rem; }
    
    /* ‚îÄ‚îÄ AI Tools Section ‚îÄ‚îÄ */
    .tools-section { max-width: 1100px; margin: 0 auto; padding: 80px 40px 40px; }
    .tools-section .section-title { text-align: center; margin-bottom: 16px; }
    .tools-subtitle { text-align: center; color: var(--muted); font-size: 0.95rem; margin-bottom: 48px; }
    .tools-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px; }
    .tool-card {
      background: var(--surface); border: 1px solid var(--border); border-radius: 16px;
      padding: 32px 28px; position: relative; overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .tool-card:hover { transform: translateY(-6px); box-shadow: 0 20px 60px rgba(0,0,0,0.4); }
    .tool-card::before {
      content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; border-radius: 16px 16px 0 0;
    }
    .tool-card.suno::before { background: linear-gradient(90deg, #e8ff47, #a3e635); }
    .tool-card.udio::before { background: linear-gradient(90deg, #818cf8, #c084fc); }
    .tool-card.elevenlabs::before { background: linear-gradient(90deg, #38bdf8, #22d3ee); }
    .tool-card .tool-icon {
      width: 56px; height: 56px; border-radius: 14px;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.6rem; margin-bottom: 20px; font-weight: 700;
    }
    .tool-card.suno .tool-icon { background: rgba(232,255,71,0.12); color: var(--accent); }
    .tool-card.udio .tool-icon { background: rgba(129,140,248,0.15); color: #818cf8; }
    .tool-card.elevenlabs .tool-icon { background: rgba(56,189,248,0.15); color: #38bdf8; }
    .tool-card .tool-name { font-family: 'Bebas Neue', sans-serif; font-size: 1.6rem; letter-spacing: 1px; margin-bottom: 8px; }
    .tool-card .tool-tagline { color: var(--muted); font-size: 0.85rem; margin-bottom: 20px; line-height: 1.5; }
    .tool-card .tool-features { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 24px; }
    .tool-card .tool-tag {
      background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.08);
      padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; color: var(--muted); font-weight: 500;
    }
    .tool-card .tool-cta {
      display: inline-flex; align-items: center; gap: 8px;
      font-size: 0.85rem; font-weight: 600; text-decoration: none; transition: gap 0.2s ease;
    }
    .tool-card.suno .tool-cta { color: var(--accent); }
    .tool-card.udio .tool-cta { color: #818cf8; }
    .tool-card.elevenlabs .tool-cta { color: #38bdf8; }
    .tool-card .tool-cta:hover { gap: 14px; }

    @media (max-width: 680px) {
      .tools-grid { grid-template-columns: 1fr; }
      .tools-section { padding: 60px 20px 20px; }
      nav { padding: 0 16px; }
      .nav-links { gap: 16px; }
      .hero { padding: 80px 20px 60px; }
      .tracks-section { padding: 40px 16px; }
      .leaderboard-section { padding: 40px 16px; }
    }

    footer { background: var(--surface); border-top: 1px solid var(--border); padding: 40px 20px; margin-top: 80px; }
    .footer-content { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px; }
    .footer-links { display: flex; gap: 24px; flex-wrap: wrap; }
    .footer-links a { color: var(--muted); text-decoration: none; font-size: 0.85rem; transition: color 0.2s; }
    .footer-links a:hover { color: var(--text); }
    .footer-copy { color: var(--muted); font-size: 0.85rem; }
  </style>
</head>
<body>

<nav>
  <a href="/" class="logo">VOTEMYAI</a>
  <div class="nav-links">
    <a href="#tracks">Tracks</a>
    <a href="/login.html" id="authLink">Login</a>
    <button class="btn-logout" id="logoutBtn" onclick="logout()">Logout</button>
    <button class="btn-submit" onclick="window.location.href='/submit.html'">Submit Track</button>
  </div>
</nav>

<div class="hero">
  <h1>VOTE<br><span class="accent">THE</span><br>FUTURE</h1>
  <p>Submit your AI-generated tracks. The community votes. The best rise to the top.</p>
</div>

<div class="tracks-section" id="tracks">
  <div class="section-title">üî• Trending Tracks</div>
  
  <div class="genre-filters">
    <button class="genre-btn active" onclick="filterGenre('all')">All</button>
    <button class="genre-btn" onclick="filterGenre('Electronic')">üéπ Electronic</button>
    <button class="genre-btn" onclick="filterGenre('Hip-Hop')">üé§ Hip-Hop</button>
    <button class="genre-btn" onclick="filterGenre('Pop')">üéµ Pop</button>
    <button class="genre-btn" onclick="filterGenre('Rock')">üé∏ Rock</button>
    <button class="genre-btn" onclick="filterGenre('Cinematic')">üé¨ Cinematic</button>
    <button class="genre-btn" onclick="filterGenre('Other')">‚ú® Other</button>
  </div>
  
  <div class="tracks-grid" id="tracksGrid">
    <div class="skeleton-card"><div class="skeleton skeleton-video"></div><div class="skeleton-info"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-meta"></div><div class="skeleton skeleton-btn"></div></div></div>
    <div class="skeleton-card"><div class="skeleton skeleton-video"></div><div class="skeleton-info"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-meta"></div><div class="skeleton skeleton-btn"></div></div></div>
    <div class="skeleton-card"><div class="skeleton skeleton-video"></div><div class="skeleton-info"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-meta"></div><div class="skeleton skeleton-btn"></div></div></div>
  </div>
</div>

<div class="leaderboard-section">
  <div class="section-title">üèÜ Top 10 Leaderboard</div>
  <div class="leaderboard" id="leaderboard">
    <div class="skeleton skeleton-lb-row"></div>
    <div class="skeleton skeleton-lb-row"></div>
    <div class="skeleton skeleton-lb-row"></div>
    <div class="skeleton skeleton-lb-row"></div>
    <div class="skeleton skeleton-lb-row"></div>
  </div>
</div>

<!-- ‚îÄ‚îÄ AI Music Tools ‚îÄ‚îÄ -->
<div class="tools-section">
  <div class="section-title">üéß Create With The Best AI Tools</div>
  <p class="tools-subtitle">The most popular platforms for making AI-generated music</p>
  <div class="tools-grid">
    <div class="tool-card suno">
      <div class="tool-icon">S</div>
      <div class="tool-name">Suno</div>
      <div class="tool-tagline">Full songs from a text prompt ‚Äî lyrics, vocals, and production in seconds. The most popular choice for creators in 2026.</div>
      <div class="tool-features">
        <span class="tool-tag">Text to Song</span><span class="tool-tag">Vocals & Lyrics</span><span class="tool-tag">All Genres</span><span class="tool-tag">Free Tier</span>
      </div>
      <a href="https://suno.com" class="tool-cta" target="_blank" rel="noopener">Try Suno <span class="arrow">‚Üí</span></a>
    </div>
    <div class="tool-card udio">
      <div class="tool-icon">U</div>
      <div class="tool-name">Udio</div>
      <div class="tool-tagline">High-fidelity music generation with realistic instrumentation. Known for creative experimentation and genre-blending.</div>
      <div class="tool-features">
        <span class="tool-tag">Hi-Fi Audio</span><span class="tool-tag">Genre Blending</span><span class="tool-tag">Voice Styles</span><span class="tool-tag">Free Tier</span>
      </div>
      <a href="https://www.udio.com" class="tool-cta" target="_blank" rel="noopener">Try Udio <span class="arrow">‚Üí</span></a>
    </div>
    <div class="tool-card elevenlabs">
      <div class="tool-icon">XI</div>
      <div class="tool-name">ElevenLabs Music</div>
      <div class="tool-tagline">From the leaders in AI voice tech. Copyright-cleared music generation with studio-grade vocal quality.</div>
      <div class="tool-features">
        <span class="tool-tag">Copyright Cleared</span><span class="tool-tag">Pro Vocals</span><span class="tool-tag">Studio Quality</span><span class="tool-tag">API Access</span>
      </div>
      <a href="https://elevenlabs.io" class="tool-cta" target="_blank" rel="noopener">Try ElevenLabs <span class="arrow">‚Üí</span></a>
    </div>
  </div>
</div>

<script type="module">
  const SUPABASE_URL = 'https://gezijezmsecbtzytotax.supabase.co';
  const SUPABASE_KEY = 'sb_publishable_hOOMtCz7gYsu_-CVD6lW9Q_SxtFlNhw';
  
  let currentUser = null;
  let userVotes = [];
  let allTracks = [];
  let currentGenre = 'all';
  
  // ‚îÄ‚îÄ XSS Sanitization ‚îÄ‚îÄ
  function sanitize(str) {
    if (!str) return '';
    const div = document.createElement('div');
    div.textContent = str;
    return div.innerHTML;
  }
  
  // ‚îÄ‚îÄ Platform helpers ‚îÄ‚îÄ
  // yt_id format: "soundcloud:URL" or plain YouTube ID
  function getTrackPlatform(track) {
    const val = track.yt_id || '';
    if (val.startsWith('soundcloud:')) return 'soundcloud';
    return 'youtube';
  }
  
  function getTrackEmbedId(track) {
    const val = track.yt_id || '';
    if (val.startsWith('soundcloud:')) return val.substring(11);
    return val;
  }
  
  function generateVisualizerBars(count) {
    let bars = '';
    for (let i = 0; i < count; i++) {
      const minH = 8 + Math.random() * 20;
      const maxH = 40 + Math.random() * 100;
      const duration = (0.6 + Math.random() * 1.2).toFixed(2);
      const delay = (Math.random() * 1.5).toFixed(2);
      bars += `<div class="viz-bar" style="--min-h:${minH}px;--max-h:${maxH}px;--duration:${duration}s;--delay:${delay}s"></div>`;
    }
    return bars;
  }
  
  function renderEmbed(track) {
    const platform = getTrackPlatform(track);
    const embedId = getTrackEmbedId(track);
    const safeId = encodeURIComponent(embedId);
    
    if (platform === 'youtube') {
      return `<div class="track-embed youtube">
        <iframe src="https://www.youtube.com/embed/${safeId}" allowfullscreen loading="lazy"></iframe>
      </div>`;
    }
    
    if (platform === 'soundcloud') {
      return `<div class="visualizer-bg soundcloud-bg">
        ${generateVisualizerBars(40)}
        <div class="visualizer-embed soundcloud-embed">
          <iframe scrolling="no" allow="autoplay" src="https://w.soundcloud.com/player/?url=${safeId}&color=%23ff8800&auto_play=false&hide_related=true&show_comments=false&show_user=true&show_reposts=false&show_teaser=false&visual=false" loading="lazy"></iframe>
        </div>
      </div>`;
    }
    
    return '<div class="track-embed youtube" style="background:var(--surface);height:180px;display:flex;align-items:center;justify-content:center;color:var(--muted);">No preview</div>';
  }
  
  function platformBadge(platform) {
    const map = {
      youtube: '<span class="platform-label yt">‚ñ∂ YouTube</span>',
      soundcloud: '<span class="platform-label sc">‚òÅ SoundCloud</span>'
    };
    return map[platform] || '';
  }
  
  // ‚îÄ‚îÄ Auth ‚îÄ‚îÄ
  async function checkAuth() {
    const hash = window.location.hash.substring(1);
    const params = new URLSearchParams(hash);
    const accessToken = params.get('access_token');
    
    if (accessToken) {
      const res = await fetch(`${SUPABASE_URL}/auth/v1/user`, {
        headers: { 'Authorization': `Bearer ${accessToken}`, 'apikey': SUPABASE_KEY }
      });
      if (res.ok) {
        currentUser = await res.json();
        localStorage.setItem('sb_token', accessToken);
        window.history.replaceState(null, '', window.location.pathname);
        
        const redirect = localStorage.getItem('login_redirect');
        if (redirect && redirect !== '/' && redirect !== window.location.pathname && redirect !== window.location.href) {
          localStorage.removeItem('login_redirect');
          window.location.href = redirect;
          return;
        }
        localStorage.removeItem('login_redirect');
      }
    } else {
      const token = localStorage.getItem('sb_token');
      if (token) {
        const res = await fetch(`${SUPABASE_URL}/auth/v1/user`, {
          headers: { 'Authorization': `Bearer ${token}`, 'apikey': SUPABASE_KEY }
        });
        if (res.ok) {
          currentUser = await res.json();
        } else {
          localStorage.removeItem('sb_token');
        }
      }
    }
    
    if (currentUser) {
      await loadUserVotes();
      updateNavAuth();
    }
  }
  
  function updateNavAuth() {
    const authLink = document.getElementById('authLink');
    const logoutBtn = document.getElementById('logoutBtn');
    if (currentUser && authLink) {
      authLink.textContent = currentUser.user_metadata?.name || 'Profile';
      authLink.href = '/profile.html';
      logoutBtn.style.display = 'inline-block';
    }
  }
  
  window.logout = function() {
    localStorage.removeItem('sb_token');
    localStorage.removeItem('anon_votes');
    window.location.href = '/';
  };
  
  async function loadUserVotes() {
    if (!currentUser) return;
    const token = localStorage.getItem('sb_token');
    const res = await fetch(`${SUPABASE_URL}/rest/v1/votes?user_id=eq.${currentUser.id}&select=track_id`, {
      headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${token}` }
    });
    if (res.ok) {
      const votes = await res.json();
      userVotes = votes.map(v => v.track_id);
    }
  }
  
  async function loadTracks() {
    try {
      const res = await fetch(`${SUPABASE_URL}/rest/v1/tracks?select=*&order=votes.desc`, {
        headers: { 'apikey': SUPABASE_KEY }
      });
      allTracks = await res.json();
      renderTracks();
      renderLeaderboard();
    } catch (err) {
      console.error('Error:', err);
      document.getElementById('tracksGrid').innerHTML = '<p style="color: var(--muted); grid-column: 1/-1; text-align: center; padding: 60px;">Failed to load tracks. Please refresh.</p>';
    }
  }
  
  function renderTracks() {
    const grid = document.getElementById('tracksGrid');
    const filteredTracks = currentGenre === 'all' 
      ? allTracks 
      : allTracks.filter(t => t.genre === currentGenre);
    
    if (!filteredTracks || filteredTracks.length === 0) {
      grid.innerHTML = '<p style="color: var(--muted); grid-column: 1/-1; text-align: center; padding: 60px;">No tracks in this genre yet!</p>';
      return;
    }
    
    grid.innerHTML = filteredTracks.map(track => {
      const anonVotes = JSON.parse(localStorage.getItem('anon_votes') || '[]');
      const hasVoted = userVotes.includes(track.id) || anonVotes.includes(track.id);
      const btnClass = hasVoted ? 'vote-btn voted' : 'vote-btn';
      const btnText = hasVoted ? '‚úì Voted' : '‚ñ≤ Vote';
      const btnDisabled = hasVoted ? 'disabled' : '';
      const platform = getTrackPlatform(track);
      
      return `
        <div class="track-card">
          ${renderEmbed(track)}
          <div class="track-info">
            <div class="track-title">${sanitize(track.title)}</div>
            <div class="track-meta">
              ${platformBadge(platform)}
              <span>${sanitize(track.tool)} ‚Ä¢ ${sanitize(track.genre)}</span>
            </div>
            <button class="${btnClass}" onclick="vote('${track.id}')" ${btnDisabled}>${btnText}</button>
            <div class="votes-count">${parseInt(track.votes) || 0} votes</div>
            <div class="comments-section">
              <button class="comments-toggle" onclick="toggleComments('${track.id}')">üí¨ Comments</button>
              <div class="comments-list" id="comments-${track.id}">
                <div id="comments-content-${track.id}"><p style="font-size:0.8rem;color:var(--muted);">Loading comments...</p></div>
                ${currentUser ? `
                  <input type="text" class="comment-input" id="comment-input-${track.id}" placeholder="Add a comment..." maxlength="500">
                  <button class="comment-btn" onclick="addComment('${track.id}')">Post</button>
                ` : '<p style="font-size:0.8rem;color:var(--muted);margin-top:8px;">Log in to comment</p>'}
              </div>
            </div>
          </div>
        </div>
      `;
    }).join('');
  }
  
  function renderLeaderboard() {
    const lb = document.getElementById('leaderboard');
    const top10 = [...allTracks].sort((a, b) => (b.votes || 0) - (a.votes || 0)).slice(0, 10);
    
    if (top10.length === 0) {
      lb.innerHTML = '<p style="color: var(--muted); text-align: center; padding: 40px;">No tracks yet!</p>';
      return;
    }
    
    lb.innerHTML = top10.map((track, i) => {
      const rank = i + 1;
      const medals = ['ü•á', 'ü•à', 'ü•â'];
      const displayRank = rank <= 3 ? medals[i] : `#${rank}`;
      const platform = getTrackPlatform(track);
      
      return `
        <div class="lb-row">
          <div class="lb-rank ${rank <= 3 ? 'top3' : ''}">${displayRank}</div>
          <div class="lb-info">
            <div class="lb-title">${sanitize(track.title)}</div>
            <div class="lb-meta">${platformBadge(platform)} <span>${sanitize(track.tool)} ‚Ä¢ ${sanitize(track.genre)}</span></div>
          </div>
          <div class="lb-votes">${parseInt(track.votes) || 0} votes</div>
        </div>
      `;
    }).join('');
  }
  
  window.filterGenre = function(genre) {
    currentGenre = genre;
    document.querySelectorAll('.genre-btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    renderTracks();
  };
  
  window.toggleComments = async function(trackId) {
    const list = document.getElementById(`comments-${trackId}`);
    if (!list.classList.contains('show')) {
      list.classList.add('show');
      await loadComments(trackId);
    } else {
      list.classList.remove('show');
    }
  };
  
  async function loadComments(trackId) {
    try {
      const res = await fetch(`${SUPABASE_URL}/rest/v1/comments?track_id=eq.${trackId}&select=*&order=created_at.desc`, {
        headers: { 'apikey': SUPABASE_KEY }
      });
      const comments = await res.json();
      const content = document.getElementById(`comments-content-${trackId}`);
      content.innerHTML = comments.length ? comments.map(c => `
        <div class="comment">
          <div class="comment-text">${sanitize(c.content)}</div>
          <div class="comment-author">‚Äî ${sanitize(c.author_name || 'Anonymous')}</div>
        </div>
      `).join('') : '<p style="font-size:0.8rem;color:var(--muted);">No comments yet</p>';
    } catch (err) {
      console.error('Load comments error:', err);
    }
  }
  
  window.addComment = async function(trackId) {
    const input = document.getElementById(`comment-input-${trackId}`);
    const content = input.value.trim();
    if (!content) return;
    if (content.length > 500) { alert('Comment too long (max 500 characters)'); return; }
    
    const token = localStorage.getItem('sb_token');
    if (!token || !currentUser) { alert('Please log in to comment'); return; }
    
    const authorName = currentUser.user_metadata?.name || currentUser.email?.split('@')[0] || 'Anonymous';
    
    try {
      await fetch(`${SUPABASE_URL}/rest/v1/comments`, {
        method: 'POST',
        headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${token}`, 'Content-Type': 'application/json' },
        body: JSON.stringify({ track_id: trackId, user_id: currentUser.id, content, author_name: authorName })
      });
      input.value = '';
      await loadComments(trackId);
    } catch (err) { console.error('Add comment error:', err); }
  };
  
  window.vote = async function(trackId) {
    const anonVotes = JSON.parse(localStorage.getItem('anon_votes') || '[]');
    if (anonVotes.includes(trackId)) { alert('You already voted for this track!'); return; }
    
    try {
      await fetch(`${SUPABASE_URL}/rest/v1/rpc/increment_votes`, {
        method: 'POST',
        headers: { 'apikey': SUPABASE_KEY, 'Content-Type': 'application/json' },
        body: JSON.stringify({ track_id: trackId })
      });
      
      anonVotes.push(trackId);
      localStorage.setItem('anon_votes', JSON.stringify(anonVotes));
      
      if (currentUser) {
        const token = localStorage.getItem('sb_token');
        await fetch(`${SUPABASE_URL}/rest/v1/votes`, {
          method: 'POST',
          headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${token}`, 'Content-Type': 'application/json', 'Prefer': 'return=minimal' },
          body: JSON.stringify({ user_id: currentUser.id, track_id: trackId })
        });
        userVotes.push(trackId);
      }
      
      await loadTracks();
    } catch (err) {
      console.error('Vote error:', err);
      alert('Failed to vote. Please try again.');
    }
  };
  
  checkAuth().then(loadTracks);
</script>

<footer>
  <div class="footer-content">
    <div class="footer-copy">¬© 2026 VoteMyAI. All rights reserved.</div>
    <div class="footer-links">
      <a href="/faq.html">FAQ</a>
      <a href="/contact.html">Contact</a>
      <a href="/terms.html">Terms</a>
      <a href="/privacy.html">Privacy</a>
    </div>
  </div>
</footer>

</body>
</html>
